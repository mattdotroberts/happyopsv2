---
// Lightbox component - activated by PhotoGallery or other components
// No props needed - controlled via JavaScript
---

<div class="lightbox" id="lightbox" aria-hidden="true">
  <button class="lightbox__close" aria-label="Close lightbox">&times;</button>
  <button class="lightbox__prev" aria-label="Previous image">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
  </button>
  <button class="lightbox__next" aria-label="Next image">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </button>
  <div class="lightbox__content">
    <img class="lightbox__image" src="" alt="" />
    <p class="lightbox__caption"></p>
  </div>
  <div class="lightbox__counter">
    <span class="lightbox__current">1</span> / <span class="lightbox__total">1</span>
  </div>
</div>

<script>
  const lightbox = document.getElementById('lightbox') as HTMLElement;
  const lightboxImage = lightbox?.querySelector('.lightbox__image') as HTMLImageElement;
  const lightboxCaption = lightbox?.querySelector('.lightbox__caption') as HTMLElement;
  const lightboxCurrent = lightbox?.querySelector('.lightbox__current') as HTMLElement;
  const lightboxTotal = lightbox?.querySelector('.lightbox__total') as HTMLElement;
  const closeBtn = lightbox?.querySelector('.lightbox__close') as HTMLButtonElement;
  const prevBtn = lightbox?.querySelector('.lightbox__prev') as HTMLButtonElement;
  const nextBtn = lightbox?.querySelector('.lightbox__next') as HTMLButtonElement;

  let currentImages: { src: string; alt: string; caption?: string }[] = [];
  let currentIndex = 0;

  // Open lightbox
  window.openLightbox = (images: { src: string; alt: string; caption?: string }[], startIndex = 0) => {
    currentImages = images;
    currentIndex = startIndex;
    lightboxTotal.textContent = String(images.length);
    showImage(currentIndex);
    lightbox.classList.add('lightbox--open');
    lightbox.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  };

  // Close lightbox
  const closeLightbox = () => {
    lightbox.classList.remove('lightbox--open');
    lightbox.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  };

  // Show specific image
  const showImage = (index: number) => {
    if (index < 0) index = currentImages.length - 1;
    if (index >= currentImages.length) index = 0;
    currentIndex = index;

    const image = currentImages[currentIndex];
    lightboxImage.src = image.src;
    lightboxImage.alt = image.alt || '';
    lightboxCaption.textContent = image.caption || '';
    lightboxCaption.style.display = image.caption ? 'block' : 'none';
    lightboxCurrent.textContent = String(currentIndex + 1);

    // Hide nav if only one image
    const showNav = currentImages.length > 1;
    prevBtn.style.display = showNav ? 'flex' : 'none';
    nextBtn.style.display = showNav ? 'flex' : 'none';
  };

  // Event listeners
  closeBtn?.addEventListener('click', closeLightbox);
  prevBtn?.addEventListener('click', () => showImage(currentIndex - 1));
  nextBtn?.addEventListener('click', () => showImage(currentIndex + 1));

  // Close on background click
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!lightbox.classList.contains('lightbox--open')) return;

    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') showImage(currentIndex - 1);
    if (e.key === 'ArrowRight') showImage(currentIndex + 1);
  });

  // Declare global function type
  declare global {
    interface Window {
      openLightbox: (images: { src: string; alt: string; caption?: string }[], startIndex?: number) => void;
    }
  }
</script>

<style>
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .lightbox--open {
    opacity: 1;
    visibility: visible;
  }

  .lightbox__content {
    max-width: 90vw;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .lightbox__image {
    max-width: 100%;
    max-height: 80vh;
    object-fit: contain;
    border-radius: var(--border-radius-md);
  }

  .lightbox__caption {
    margin-top: var(--space-md);
    color: rgba(255, 255, 255, 0.8);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    text-align: center;
  }

  .lightbox__close {
    position: absolute;
    top: var(--space-lg);
    right: var(--space-lg);
    width: 48px;
    height: 48px;
    border: none;
    background: transparent;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity var(--transition-fast);
  }

  .lightbox__close:hover {
    opacity: 1;
  }

  .lightbox__prev,
  .lightbox__next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 56px;
    height: 56px;
    border: none;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
    transition: opacity var(--transition-fast), background var(--transition-fast);
  }

  .lightbox__prev:hover,
  .lightbox__next:hover {
    opacity: 1;
    background: rgba(255, 255, 255, 0.2);
  }

  .lightbox__prev {
    left: var(--space-lg);
  }

  .lightbox__next {
    right: var(--space-lg);
  }

  .lightbox__counter {
    position: absolute;
    bottom: var(--space-lg);
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255, 255, 255, 0.6);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
  }

  @media (max-width: 768px) {
    .lightbox__prev,
    .lightbox__next {
      width: 44px;
      height: 44px;
    }

    .lightbox__prev {
      left: var(--space-sm);
    }

    .lightbox__next {
      right: var(--space-sm);
    }
  }
</style>
